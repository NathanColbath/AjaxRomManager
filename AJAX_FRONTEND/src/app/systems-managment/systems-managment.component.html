<div class="container-fluid mt-4 px-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">
          <i class="fas fa-desktop me-2"></i>
          Platform Management
        </h2>
        <button type="button" class="btn btn-primary" routerLink="/systems-add">
          <i class="fas fa-plus me-1"></i>
          Add New Platform
        </button>
      </div>
    </div>
  </div>

  <!-- Search and Filter Bar -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="input-group">
                <span class="input-group-text">
                  <i class="fas fa-search"></i>
                </span>
                <input type="text" class="form-control" 
                       name="searchTerm"
                       [(ngModel)]="searchTerm" 
                       (input)="onSearchChange()"
                       placeholder="Search platforms...">
              </div>
            </div>
            <div class="col-md-3">
              <select class="form-select" name="statusFilter" [(ngModel)]="statusFilter" (change)="onStatusFilterChange()">
                <option value="">All Status</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>
            <div class="col-md-3">
              <select class="form-select" name="sortBy" [(ngModel)]="sortBy" (change)="onSortChange()">
                <option value="name">Sort by Name</option>
                <option value="created">Sort by Created Date</option>
                <option value="roms">Sort by ROM Count</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Platforms Grid -->
  <div class="row">
    <div class="col-12">
      <div class="row" *ngIf="filteredPlatforms.length > 0; else noPlatforms">
        <div class="col-lg-4 col-md-6 mb-4" *ngFor="let platform of filteredPlatforms">
          <div class="card platform-card h-100">
            <div class="card-body">
              <!-- Platform Header -->
              <div class="d-flex align-items-start mb-3">
                <div class="platform-icon me-3">
                  <img *ngIf="platform.iconPath" [src]="getPlatformLogoUrl(platform)" 
                       [alt]="platform.name + ' logo'" 
                       class="img-fluid rounded" style="width: 50px; height: 50px; object-fit: cover;">
                  <div *ngIf="!platform.iconPath" class="platform-placeholder-small">
                    <i class="fas fa-desktop fa-2x text-muted"></i>
                  </div>
                </div>
                <div class="flex-grow-1">
                  <h5 class="card-title mb-1">{{ platform.name }}</h5>
                  <span class="badge" 
                        [class]="platform.isActive ? 'bg-success' : 'bg-secondary'">
                    {{ platform.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </div>
                <div class="dropdown">
                  <button class="btn btn-sm btn-outline-secondary" type="button" 
                          data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-ellipsis-v"></i>
                  </button>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" (click)="editPlatform(platform)">
                        <i class="fas fa-edit me-2"></i>Edit
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" (click)="togglePlatformStatus(platform)">
                        <i class="fas fa-power-off me-2"></i>
                        {{ platform.isActive ? 'Deactivate' : 'Activate' }}
                      </a>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                      <a class="dropdown-item text-danger" (click)="deletePlatform(platform)">
                        <i class="fas fa-trash me-2"></i>Delete
                      </a>
                    </li>
                  </ul>
                </div>
              </div>

              <!-- Platform Description -->
              <p class="card-text text-muted small mb-3">
                {{ platform.description || 'No description provided' }}
              </p>

              <!-- Supported Extensions -->
              <div class="mb-3">
                <label class="form-label small fw-bold">Supported Extensions:</label>
                <div class="extensions-list">
                  <span class="badge bg-secondary me-1 mb-1" 
                        *ngFor="let ext of platform.extensions">
                    .{{ ext }}
                  </span>
                </div>
              </div>

              <!-- Platform Stats -->
              <div class="row text-center small text-muted">
                <div class="col-4">
                  <div class="fw-bold">{{ platform.roms?.length || 0 }}</div>
                  <div>ROMs</div>
                </div>
                <div class="col-4">
                  <div class="fw-bold">{{ platform.scanJobs?.length || 0 }}</div>
                  <div>Scan Jobs</div>
                </div>
                <div class="col-4">
                  <div class="fw-bold">{{ getLastScanDate(platform) | date:'short' || 'Never' }}</div>
                  <div>Last Scan</div>
                </div>
              </div>

              <!-- Emulator Info -->
              <div class="mt-3" *ngIf="platform.emulatorPath">
                <small class="text-muted">
                  <i class="fas fa-play me-1"></i>
                  Emulator: {{ getEmulatorName(platform.emulatorPath) }}
                </small>
              </div>
            </div>

            <!-- Card Footer -->
            <div class="card-footer bg-transparent">
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">
                  Created: {{ platform.createdAt | date:'short' }}
                </small>
                <div class="btn-group btn-group-sm">
                  <button type="button" class="btn btn-outline-primary" 
                          (click)="viewPlatformDetails(platform)">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button type="button" class="btn btn-outline-success" 
                          (click)="scanPlatform(platform)">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- No Platforms Message -->
      <ng-template #noPlatforms>
        <div class="text-center py-5">
          <i class="fas fa-desktop fa-4x text-muted mb-3"></i>
          <h4 class="text-muted">No Platforms Found</h4>
          <p class="text-muted">Get started by adding your first gaming platform.</p>
          <button type="button" class="btn btn-primary" routerLink="/systems-add">
            <i class="fas fa-plus me-1"></i>
            Add Your First Platform
          </button>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Pagination -->
  <div class="row" *ngIf="filteredPlatforms.length > 0">
    <div class="col-12">
      <nav aria-label="Platform pagination">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="previousPage()">Previous</a>
          </li>
          <li class="page-item" 
              *ngFor="let page of getPageNumbers()" 
              [class.active]="page === currentPage">
            <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="nextPage()">Next</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>
